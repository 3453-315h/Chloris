
# Climate Lab Implementation Guide

## Overview
The Climate Lab module transforms the application from a biological simulator into a physical engineering tool. It focuses on the **physics of the grow environment**, specifically the relationship between Temperature, Humidity, and Transpiration (Vapor Pressure Deficit).

## Core Physics

### 1. Vapor Pressure Deficit (VPD)
VPD is the driving force behind water movement in plants. It is the difference between the pressure inside the wet leaf (assumed saturated) and the air outside.

**Formula:**
$$ VPD = SVP_{leaf} - AVP_{air} $$

Where:
1.  **Saturation Vapor Pressure (SVP):** Calculated using the Arrhenius equation.
    $$ SVP = 0.61078 \times e^{\frac{17.27 \times T}{T + 237.3}} $$
2.  **Actual Vapor Pressure (AVP):**
    $$ AVP = SVP_{air} \times \frac{RH}{100} $$
3.  **Leaf Temperature Offset:**
    Leaves are typically 1-2°C cooler than the air due to evaporative cooling. If $T_{leaf} > T_{air}$, the plant is stressed (stomata closed).

### 2. HVAC Calculations
To maintain the environment, we must remove the heat generated by lights and equipment.

**Sensible Heat Load:**
$$ BTU_{lights} = Watts \times 3.412 $$

**Total Cooling Load:**
We apply a buffer (typically 20-30%) to account for dehumidifiers, pumps, and wall heat transfer.
$$ BTU_{total} = BTU_{lights} \times 1.2 $$

**Tonnage:**
$$ Tons = \frac{BTU_{total}}{12,000} $$

### 3. Airflow Dynamics (CFM)
Exhaust fans must exchange the air in the room to replenish CO2 and remove heat/humidity.

**Formula:**
$$ CFM = \frac{Room Volume (ft^3)}{Exchange Rate (min)} $$

*   **Standard Rate:** 3 minutes.
*   **High Heat Rate:** 1 minute.

## Implementation Details

### Data Structures
We extended `CropProfile` to include `vpdRange`:
```typescript
vpdRange?: {
    min: number; // e.g., 0.8 kPa
    max: number; // e.g., 1.2 kPa
}
```

### Visualization
The module uses a computed "Heatmap Grid". Instead of a library chart, we generate a 5x5 grid of `divs`.
*   **Center Cell:** Current Temp/RH.
*   **X-Axis:** Temperature variance (-4°C to +4°C).
*   **Y-Axis:** Humidity variance (+10% to -10%).
*   **Color Logic:**
    *   Green: Within optimal VPD range.
    *   Blue: Low VPD (Risk of Mold/PM).
    *   Orange: High VPD (Risk of Wilting).

## Future Expansion
1.  **Psychrometric Chart**: A full SVG implementation of the Mollier diagram.
2.  **Dew Point Calculator**: Alerting when leaf temp hits dew point (condensation risk).
3.  **Dehumidification Sizing**: Calculating Pints/Day water removal based on transpiration rates.
